<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Fid Master — SDK Ready</title>

  <!-- ICONS -->
  <link rel="icon" href="https://fidmasters.vercel.app/icon.png" />
  <meta property="og:image" content="https://fidmasters.vercel.app/splash.png" />
  <meta name="theme-color" content="#7c3aed"/>

  <!-- FARCATER FRAME META -->
  <meta name="fc:frame" content='{{"version":"next","imageUrl":"https://fidmasters.vercel.app/splash.png","button":{{"title":"Open","action":{{"type":"launch_frame","name":"Fid Master","url":"https://fidmasters.vercel.app"}}}}}}' />

  <style>
    :root{{--bg1:#0a0f24;--bg2:#11192d;--card:rgba(255,255,255,0.05);--accent:#7c3aed;--muted:#cbd5e1;font-family:Inter,system-ui,Arial}}
    body{{margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#fff}}
    .wrap{{max-width:960px;margin:40px auto;padding:16px}}
    .card{{background:var(--card);padding:20px;border-radius:16px}}
    .logo{{width:64px;height:64px;border-radius:12px;background:url("https://fidmasters.vercel.app/icon.png") center/cover}}
    .btn{{padding:10px 14px;border-radius:10px;background:rgba(255,255,255,.08);border:0;color:#fff;cursor:pointer}}
    .btn.primary{{background:linear-gradient(90deg,#06b6d4,#7c3aed)}}
    input{{width:100%;padding:10px;border-radius:10px;background:rgba(0,0,0,.1);border:1px solid rgba(255,255,255,.08);color:white}}
    iframe{{width:100%;height:520px;border:0;background:white}}
  </style>

  <!-- Farcaster Frames SDK (UMD) -->
  <script src="https://unpkg.com/@farcaster/frame-host@latest/dist/index.umd.min.js"></script>
  <script src="https://unpkg.com/@farcaster/frame-sdk@latest/dist/index.umd.min.js"></script>
</head>

<body>
<div class="wrap">

<main class="card">
  <header style="display:flex;gap:12px;align-items:center">
    <div class="logo" aria-hidden="true"></div>
    <div>
      <h1 style="margin:0">Fid Master</h1>
      <p style="margin:0;color:var(--muted)">Secure your Master — claim whitelist</p>
    </div>
  </header>

  <div style="margin-top:18px;display:flex;gap:10px;flex-wrap:wrap">
    <button id="btnMeta" class="btn">Connect MetaMask</button>
    <button id="btnWC" class="btn">WalletConnect</button>
    <button id="btnAuth" class="btn primary">Sign in with Farcaster</button>
    <button id="btnDC" class="btn" style="display:none">Disconnect</button>
    <a class="btn" href="https://opensea.io/collection/fidmaster/overview" target="_blank">OpenSea</a>
  </div>

  <div id="box" style="display:none;margin-top:14px;padding:14px;background:rgba(255,255,255,.03);border-radius:12px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <label style="font-size:12px;color:var(--muted)">Connected Wallet</label>
        <div id="addr" style="font-family:ui-monospace,Menlo,monospace;padding:6px 10px;background:rgba(0,0,0,.15);border-radius:8px"></div>
      </div>

      <div style="text-align:right">
        <div id="wl" style="color:#4ade80;font-weight:600;display:none">✓ You're on the whitelist!</div>
        <button id="copy" class="btn" style="margin-top:6px">Copy</button>
      </div>
    </div>

    <div style="margin-top:12px;display:flex;gap:8px">
      <button id="share" class="btn primary">Share on Farcaster</button>
      <button id="toggleFrame" class="btn">Open Frame</button>
    </div>

    <label style="margin-top:12px;display:block;color:var(--muted)">Message</label>
    <input id="msg" value="I claimed an early whitelist spot for Fid Master!" />

    <div id="frameBox" style="display:none;margin-top:12px;border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,.08)">
      <iframe id="frame" sandbox="allow-scripts allow-forms allow-same-origin allow-popups"></iframe>
    </div>
  </div>

</main>

</div>

<!-- Wallet libs -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.7.8/dist/umd/index.min.js"></script>

<script>
(function(){
  const WC = window.WalletConnectProvider && (window.WalletConnectProvider.default || window.WalletConnectProvider);
  const { ethers } = window.ethers || {};

  const $ = id => document.getElementById(id);

  const btnMeta = $('btnMeta');
  const btnWC = $('btnWC');
  const btnAuth = $('btnAuth');
  const btnDC = $('btnDC');
  const box = $('box');
  const addrEl = $('addr');
  const copy = $('copy');
  const msg = $('msg');
  const share = $('share');
  const toggleFrame = $('toggleFrame');
  const frameBox = $('frameBox');
  const frame = $('frame');

  let provider=null, signer=null, wc=null, address=null;

  const short = a => a ? (a.slice(0,6) + '...' + a.slice(-4)) : '—';

  function show(addr){
    address=addr;
    addrEl.textContent = short(addr);
    box.style.display='block';
    btnDC.style.display='inline-block';
    btnMeta.style.display='none';
    btnWC.style.display='none';
    $('wl').style.display='block';
  }

  function hide(){
    address=null;
    provider=null;
    signer=null;
    if(wc) try{ wc.disconnect(); }catch{}
    wc=null;
    btnMeta.style.display='inline-block';
    btnWC.style.display='inline-block';
    btnDC.style.display='none';
    box.style.display='none';
    frameBox.style.display='none';
    frame.src='';
  }

  // MetaMask
  btnMeta.onclick = async()=>{
    if(!window.ethereum) return alert('MetaMask missing');
    await ethereum.request({method:'eth_requestAccounts'});
    provider=new ethers.providers.Web3Provider(window.ethereum);
    signer=provider.getSigner();
    show(await signer.getAddress());
  };

  // WalletConnect
  btnWC.onclick = async()=>{
    if(!WC) return alert('WalletConnect provider not loaded');
    wc=new WC({rpc:{1:'https://rpc.ankr.com/eth'}, qrcode:true});
    await wc.enable();
    provider=new ethers.providers.Web3Provider(wc);
    signer=provider.getSigner();
    show(await signer.getAddress());
  };

  btnDC.onclick = hide;

  copy.onclick=()=>{
    if(address) navigator.clipboard.writeText(address);
    copy.textContent='Copied!';
    setTimeout(()=>copy.textContent='Copy',1200);
  };

  // Share
  share.onclick=()=>{
    const t = encodeURIComponent((msg.value||'') + ' Wallet: ' + (address||''));
    window.open('https://warpcast.com/compose?text=' + t, '_blank');
  };

  // Frame embed
  let open = false;
  toggleFrame.onclick=()=>{
    open=!open;
    if(open){
      const t = encodeURIComponent((msg.value||'') + ' Wallet: ' + (address||''));
      frame.src = 'https://warpcast.com/compose?text=' + t;
      frameBox.style.display='block';
      toggleFrame.textContent='Close Frame';
    } else {
      frame.src='';
      frameBox.style.display='none';
      toggleFrame.textContent='Open Frame';
    }
  };

  // Farcaster Auth (requires backend)
  btnAuth.addEventListener('click', async()=>{
    try{
      const r = await fetch('/api/auth/relay',{method:'POST'});
      const j = await r.json();
      if(j.url) window.open(j.url,'_blank');
    }catch(e){ alert('Auth error'); }
  });

})();
</script>

</body>
</html>
